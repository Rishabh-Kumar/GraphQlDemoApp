(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{26:function(t,e,n){},27:function(t,e,n){},28:function(t,e,n){},30:function(t,e,n){},31:function(t,e,n){},32:function(t,e,n){},33:function(t,e,n){},34:function(t,e,n){},35:function(t,e,n){},36:function(t,e,n){},38:function(t,e,n){},39:function(t,e,n){},40:function(t,e,n){"use strict";n.r(e);var i=n(1),a=n.n(i),s=n(20),c=n.n(s),o=(n(26),n(2)),r=n(3),l=n(7),d=n(6),u=(n(27),n(17)),h=n(4),j=(n(28),a.a.createContext({token:null,userId:null,login:function(t,e,n){},logout:function(){}})),b=n(0),f=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(t){var i;return Object(o.a)(this,n),(i=e.call(this,t)).state={isLogin:!0},i.switchModeHandler=function(){i.setState((function(t){return{isLogin:!t.isLogin}}))},i.submitHandler=function(t){t.preventDefault();var e=i.emailEl.current.value,n=i.passwordEl.current.value;if(0!==e.trim().length&&0!==n.trim().length){var a={query:"\n        query Login($email: String!, $password:String!){\n          login(email: $email, password: $password) {\n            userId \n            token \n            tokenExpiration\n          }\n        }\n      ",variables:{email:e,password:n}};i.state.isLogin||(a={query:"\n        mutation CreateUser($email: String!, $password:String!){\n          createUser(userInput: {email: $email, password: $password}) {\n            _id\n            email\n          }\n        }\n      ",variables:{email:e,password:n}}),fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed");return t.json()})).then((function(t){t.data.login.token&&i.context.login(t.data.login.token,t.data.login.userId,t.data.login.tokenExpiration)})).catch((function(t){console.log(t)}))}},i.emailEl=a.a.createRef(),i.passwordEl=a.a.createRef(),i}return Object(r.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("form",{className:"auth-form",onSubmit:this.submitHandler,children:[Object(b.jsxs)("div",{className:"form-control",children:[Object(b.jsx)("label",{htmlFor:"email",children:"E-Mail"}),Object(b.jsx)("input",{type:"email",id:"email",ref:this.emailEl})]}),Object(b.jsxs)("div",{className:"form-control",children:[Object(b.jsx)("label",{htmlFor:"password",children:"Password"}),Object(b.jsx)("input",{type:"password",id:"password",ref:this.passwordEl})]}),Object(b.jsxs)("div",{className:"form-actions",children:[Object(b.jsx)("button",{type:"submit",children:"Submit"}),Object(b.jsxs)("button",{type:"button",onClick:this.switchModeHandler,children:["Switch To ",this.state.isLogin?"SignUp":"Login"]})]})]})}}]),n}(i.Component);f.contextType=j;var p=f,m=n(9),v=(n(30),function(t){return Object(b.jsxs)("div",{className:"modal",children:[Object(b.jsx)("header",{className:"modal__header",children:Object(b.jsx)("h1",{children:t.title})}),Object(b.jsx)("section",{className:"modal__content",children:t.children}),Object(b.jsxs)("section",{className:"modal__actions",children:[t.canCancel&&Object(b.jsx)("button",{className:"btn",onClick:t.onCancel,children:"Cancel"}),t.canConfirm&&Object(b.jsx)("button",{className:"btn",onClick:t.onConfirm,children:t.confirmText})]})]})}),O=(n(31),function(t){return Object(b.jsx)("div",{className:"backdrop"})}),x=(n(32),function(t){return Object(b.jsxs)("li",{className:"events__list-item",children:[Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:t.title}),Object(b.jsxs)("h2",{children:["$",t.price," - ",new Date(t.date).toLocaleDateString()]})]}),Object(b.jsx)("div",{children:t.userId===t.creatorId?Object(b.jsx)("p",{children:"Your the owner of this event."}):Object(b.jsx)("button",{className:"btn",onClick:t.onDetail.bind(undefined,t.eventId),children:"View Details"})})]},t.eventId)}),g=(n(33),function(t){var e=t.events.map((function(e){return Object(b.jsx)(x,{eventId:e._id,title:e.title,price:e.price,date:e.date,userId:t.authUserId,creatorId:e.creator._id,onDetail:t.onViewDetail},e._id)}));return Object(b.jsx)("ul",{className:"event__list",children:e})}),k=(n(34),function(){return Object(b.jsx)("div",{className:"spinner",children:Object(b.jsx)("div",{className:"lds-dual-ring"})})}),y=(n(35),function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(t){var i;return Object(o.a)(this,n),(i=e.call(this,t)).state={creating:!1,events:[],isLoading:!1,selectedEvent:null},i.isActive=!0,i.startCreateEventHandler=function(){i.setState({creating:!0})},i.modalConfirmHandler=function(){i.setState({creating:!1});var t=i.titleElRef.current.value,e=+i.priceElRef.current.value,n=i.dateElRef.current.value,a=i.descriptionElRef.current.value;if(!(0===t.trim().length||e<=0||0===n.trim().length||0===a.trim().length)){var s={title:t,price:e,date:n,description:a};console.log(s);var c={query:"\n          mutation CreateEvent($title: String!, $description: String!, $price: Float!, $date: String!){\n            createEvent(eventInput: {title: $title, description: $description, price: $price, date: $date}) {\n              _id\n              title\n              description\n              date\n              price\n            }\n          }\n        ",variables:{title:t,description:a,date:n,price:e}},o=i.context.token;fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(c),headers:{"Content-Type":"application/json",Authorization:"Bearer "+o}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed!");return t.json()})).then((function(t){i.setState((function(e){var n=Object(m.a)(e.events);return n.push({_id:t.data.createEvent._id,title:t.data.createEvent.title,description:t.data.createEvent.description,date:t.data.createEvent.date,price:t.data.createEvent.price,creator:{_id:i.context.userId}}),{events:n}}))})).catch((function(t){console.log(t)}))}},i.modalCancelHandler=function(){i.setState({creating:!1,selectedEvent:null})},i.showDetailHandler=function(t){i.setState((function(e){return{selectedEvent:e.events.find((function(e){return e._id===t}))}}))},i.bookEventHandler=function(){if(i.context.token){var t={query:"\n          mutation BookEvent($id: ID!){\n                bookEvent(eventId: $id) {\n                  _id\n                  createdAt\n                  updatedAt\n                }\n              }\n        ",variables:{id:i.state.selectedEvent._id}};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:"Bearer "+i.context.token}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed!");return t.json()})).then((function(t){console.log(t),i.setState({selectedEvent:null})})).catch((function(t){console.log(t),i.setState({selectedEvent:null})}))}else i.setState({selectedEvent:null})},i.titleElRef=a.a.createRef(),i.priceElRef=a.a.createRef(),i.dateElRef=a.a.createRef(),i.descriptionElRef=a.a.createRef(),i}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.fetchEvents()}},{key:"fetchEvents",value:function(){var t=this;this.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n          query {\n            events {\n              _id\n              title\n              description\n              date\n              price\n              creator {\n                _id\n                email\n              }\n            }\n          }\n        "}),headers:{"Content-Type":"application/json"}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed!");return t.json()})).then((function(e){var n=e.data.events;t.isActive&&t.setState({events:n,isLoading:!1})})).catch((function(e){console.log(e),t.isActive&&t.setState({isLoading:!1})}))}},{key:"componentWillUnmount",value:function(){this.isActive=!1}},{key:"render",value:function(){return Object(b.jsxs)(a.a.Fragment,{children:[(this.state.creating||this.state.selectedEvent)&&Object(b.jsx)(O,{}),this.state.creating&&Object(b.jsx)(v,{title:"Add Event",canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.modalConfirmHandler,confirmText:"Confirm",children:Object(b.jsxs)("form",{children:[Object(b.jsxs)("div",{className:"form-control",children:[Object(b.jsx)("label",{htmlFor:"title",children:"Title"}),Object(b.jsx)("input",{type:"text",id:"title",ref:this.titleElRef})]}),Object(b.jsxs)("div",{className:"form-control",children:[Object(b.jsx)("label",{htmlFor:"price",children:"Price"}),Object(b.jsx)("input",{type:"number",id:"price",ref:this.priceElRef})]}),Object(b.jsxs)("div",{className:"form-control",children:[Object(b.jsx)("label",{htmlFor:"date",children:"Date"}),Object(b.jsx)("input",{type:"datetime-local",id:"date",ref:this.dateElRef})]}),Object(b.jsxs)("div",{className:"form-control",children:[Object(b.jsx)("label",{htmlFor:"description",children:"Description"}),Object(b.jsx)("textarea",{id:"description",rows:"4",ref:this.descriptionElRef})]})]})}),this.state.selectedEvent&&Object(b.jsxs)(v,{title:this.state.selectedEvent.title,canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.bookEventHandler,confirmText:this.context.token?"Book":"Confirm",children:[Object(b.jsx)("h1",{children:this.state.selectedEvent.title}),Object(b.jsxs)("h2",{children:["$",this.state.selectedEvent.price," -"," ",new Date(this.state.selectedEvent.date).toLocaleDateString()]}),Object(b.jsx)("p",{children:this.state.selectedEvent.description})]}),this.context.token&&Object(b.jsxs)("div",{className:"events-control",children:[Object(b.jsx)("p",{children:"Share your own Events!"}),Object(b.jsx)("button",{className:"btn",onClick:this.startCreateEventHandler,children:"Create Event"})]}),this.state.isLoading?Object(b.jsx)(k,{}):Object(b.jsx)(g,{events:this.state.events,authUserId:this.context.userId,onViewDetail:this.showDetailHandler})]})}}]),n}(i.Component));y.contextType=j;var E=y,C=(n(36),function(t){return Object(b.jsx)("ul",{className:"bookings__list",children:t.bookings.map((function(e){return Object(b.jsxs)("li",{className:"bookings__item",children:[Object(b.jsxs)("div",{className:"bookings__item-data",children:[e.event.title," -"," ",new Date(e.createdAt).toLocaleDateString()]}),Object(b.jsx)("div",{className:"bookings__item-actions",children:Object(b.jsx)("button",{className:"btn",onClick:t.onDelete.bind(undefined,e._id),children:"Cancel"})})]},e._id)}))})}),S=n(21),w=(n(37),{Cheap:{min:0,max:100},Normal:{min:100,max:200},Expensive:{min:200,max:1e6}}),N=function(t){var e={labels:[],datasets:[]},n=[],i=function(i){var a=t.bookings.reduce((function(t,e){return e.event.price>w[i].min&&e.event.price<w[i].max?t+1:t}),0);n.push(a),e.labels.push(i),e.datasets.push({data:n}),(n=Object(m.a)(n))[n.length-1]=0};for(var a in w)i(a);return Object(b.jsx)("div",{style:{textAlign:"center"},children:Object(b.jsx)(S.a,{type:"bar",data:e})})},_=(n(38),void 0),T=function(t){return Object(b.jsxs)("div",{className:"bookings-control",children:[Object(b.jsx)("button",{className:"list"===t.activeOutoutType?"active":"",onClick:t.onChange.bind(_,"list"),children:"List"}),Object(b.jsx)("button",{className:"chart"===t.activeOutoutType?"active":"",onClick:t.onChange.bind(_,"chart"),children:"Chart"})]})},I=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){var t;Object(o.a)(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).state={isLoading:!1,bookings:[],outputType:"list"},t.fetchBookings=function(){t.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n          query {\n            bookings {\n              _id\n             createdAt\n             event {\n               _id\n               title\n               date\n               price\n             }\n            }\n          }\n        "}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+t.context.token}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed!");return t.json()})).then((function(e){var n=e.data.bookings;t.setState({bookings:n,isLoading:!1})})).catch((function(e){console.log(e),t.setState({isLoading:!1})}))},t.deleteBookingHandler=function(e){t.setState({isLoading:!0});var n={query:"\n          mutation cancelBooking($id: ID!){\n            cancelBooking(bookingId: $id) {\n              _id\n              title\n            }\n          }\n        ",variables:{id:e}};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json",Authorization:"Bearer "+t.context.token}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed!");return t.json()})).then((function(n){t.setState((function(t){return{bookings:t.bookings.filter((function(t){return t._id!==e})),isLoading:!1}}))})).catch((function(e){console.log(e),t.setState({isLoading:!1})}))},t.changeOutputTypeHandler=function(e){"list"===e?t.setState({outputType:"list"}):t.setState({outputType:"chart"})},t}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.fetchBookings()}},{key:"render",value:function(){var t=Object(b.jsx)(k,{});return this.state.isLoading||(t=Object(b.jsxs)(a.a.Fragment,{children:[Object(b.jsx)(T,{activeOutoutType:this.state.outputType,onChange:this.changeOutputTypeHandler}),Object(b.jsx)("div",{children:"list"===this.state.outputType?Object(b.jsx)(C,{bookings:this.state.bookings,onDelete:this.deleteBookingHandler}):Object(b.jsx)(N,{bookings:this.state.bookings})})]})),Object(b.jsx)(a.a.Fragment,{children:t})}}]),n}(i.Component);I.contextType=j;var L=I,D=(n(39),function(t){return Object(b.jsx)(j.Consumer,{children:function(t){return Object(b.jsxs)("header",{className:"main-navigation",children:[Object(b.jsx)("div",{className:"main-navigation__logo",children:Object(b.jsx)("h1",{children:"EasyEvent"})}),Object(b.jsx)("nav",{className:"main-navigation__items",children:Object(b.jsxs)("ul",{children:[!t.token&&Object(b.jsx)("li",{children:Object(b.jsx)(u.b,{to:"/auth",children:"Authentication"})}),Object(b.jsx)("li",{children:Object(b.jsx)(u.b,{to:"/events",children:"Events"})}),t.token&&Object(b.jsxs)(a.a.Fragment,{children:[Object(b.jsx)("li",{children:Object(b.jsx)(u.b,{to:"/bookings",children:"Bookings"})}),Object(b.jsx)("li",{children:Object(b.jsx)("button",{onClick:t.logout,children:"Logout"})})]})]})})]})}})}),$=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){var t;Object(o.a)(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).state={token:null,userId:null},t.login=function(e,n,i){t.setState({token:e,userId:n})},t.logout=function(){t.setState({token:null,userId:null})},t}return Object(r.a)(n,[{key:"render",value:function(){return Object(b.jsx)(u.a,{children:Object(b.jsx)(i.Fragment,{children:Object(b.jsxs)(j.Provider,{value:{token:this.state.token,userId:this.state.userId,login:this.login,logout:this.logout},children:[Object(b.jsx)(D,{}),Object(b.jsx)("main",{className:"main-content",children:Object(b.jsxs)(h.d,{children:[this.state.token&&Object(b.jsx)(h.b,{exact:!0,path:"/",element:Object(b.jsx)(h.a,{replace:!0,to:"/events"})}),this.state.token&&Object(b.jsx)(h.b,{exact:!0,path:"/auth",element:Object(b.jsx)(h.a,{replace:!0,to:"/events"})}),!this.state.token&&Object(b.jsx)(h.b,{exact:!0,path:"/auth",element:Object(b.jsx)(p,{})}),Object(b.jsx)(h.b,{exact:!0,path:"/events",element:Object(b.jsx)(E,{})}),this.state.token&&Object(b.jsx)(h.b,{exact:!0,path:"/bookings",element:Object(b.jsx)(L,{})}),!this.state.token&&Object(b.jsx)(h.b,{path:"/*",element:Object(b.jsx)(h.a,{replace:!0,to:"/auth"})})]})})]})})})}}]),n}(i.Component),H=$;c.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(H,{})}),document.getElementById("root"))}},[[40,1,2]]]);
//# sourceMappingURL=main.1843703d.chunk.js.map